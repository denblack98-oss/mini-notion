<!doctype html>
<html lang="ru">
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini Notion</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Inter", "Segoe UI", system-ui, sans-serif;
        font-family: "Inter", "SF Pro", system-ui, sans-serif;
        background: #f5f6f8;
        color: #1f1f1f;
        color: #0f172a;
        --accent: #3b82f6;
        --sidebar-bg: #f7f7f8;
        --border: #e2e8f0;
        --text-muted: #64748b;
        --surface: #ffffff;
        --surface-muted: #f1f5f9;
        --radius: 12px;
        --shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
      }

      button {
        font-family: inherit;
      }

      input,
      select {
        font-family: inherit;
      }

      .app {
        display: grid;
        grid-template-columns: 260px 1fr;
        grid-template-columns: 300px 1fr;
        width: 100%;
        min-height: 100vh;
      }

      .sidebar {
        background: #ffffff;
        border-right: 1px solid #e1e4ea;
        padding: 24px 16px;
        background: var(--sidebar-bg);
        border-right: 1px solid var(--border);
        padding: 20px 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .sidebar h1 {
      .workspace {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .workspace h1 {
        margin: 0;
        font-size: 18px;
        letter-spacing: 0.03em;
        letter-spacing: 0.02em;
      }

      .pages {
      .search-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        flex: 1;
        overflow-y: auto;
        background: #ffffff;
        border-radius: var(--radius);
        padding: 10px 12px;
        border: 1px solid var(--border);
      }

      .search-box input {
        border: none;
        background: transparent;
        outline: none;
        width: 100%;
        font-size: 14px;
      }

      .sidebar-actions {
        display: flex;
        gap: 8px;
      }

      .primary-button {
        background: var(--accent);
        color: #ffffff;
        border: none;
        border-radius: var(--radius);
        padding: 10px 14px;
        font-size: 14px;
        cursor: pointer;
      }

      .ghost-button {
        background: #ffffff;
        border: 1px solid var(--border);
        color: #0f172a;
        border-radius: var(--radius);
        padding: 8px 12px;
        font-size: 13px;
        cursor: pointer;
      }

      .sidebar-section {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .sidebar-section h2 {
        margin: 0;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-muted);
      }

      .page-tree,
      .favorites-list,
      .recent-list,
      .tag-list {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .page-item {
        border: 1px solid transparent;
        background: #f7f7f9;
        padding: 10px 12px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 10px;
        cursor: pointer;
        transition: border 0.2s ease, background 0.2s ease;
        border: 1px solid transparent;
        background: transparent;
      }

      .page-item.active {
        border-color: #c7d2fe;
        background: #eef2ff;
        background: #e8f0ff;
        border-color: #c7ddff;
      }

      .page-item span {
        font-size: 14px;
      .page-item .label {
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 14px;
      }

      .page-item button {
      .page-item .meta {
        font-size: 12px;
        color: var(--text-muted);
      }

      .page-item .star {
        color: #f59e0b;
      }

      .page-item .tree-toggle {
        border: none;
        background: transparent;
        color: #9aa3b2;
        cursor: pointer;
        font-size: 14px;
        color: var(--text-muted);
      }

      .sidebar button,
      .toolbar button {
      .page-tree .children {
        padding-left: 18px;
        border-left: 1px dashed #e2e8f0;
        margin-left: 6px;
      }

      .sidebar-footer {
        margin-top: auto;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .sidebar-footer button {
        text-align: left;
        background: transparent;
        border: none;
        padding: 8px 10px;
        border-radius: 10px;
        padding: 10px 12px;
        background: #111827;
        color: #ffffff;
        font-size: 14px;
        cursor: pointer;
      }

      .sidebar button.secondary {
        background: #f3f4f6;
        color: #111827;
        color: var(--text-muted);
      }

      .main {
        padding: 32px 48px;
        padding: 28px 40px 36px;
        display: flex;
        flex-direction: column;
        gap: 24px;
        gap: 20px;
        background: #fcfcfd;
      }

      .top-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .tag-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .title-input {
      .tag-chip {
        background: #e2e8f0;
        color: #1e293b;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 12px;
      }

      .tag-chip.active {
        background: #dbeafe;
        color: #1d4ed8;
      }

      .page-title {
        font-size: 32px;
        font-weight: 600;
        font-weight: 700;
        border: none;
        outline: none;
        background: transparent;
        width: 100%;
        background: transparent;
      }

      .page-subtitle {
        color: var(--text-muted);
        font-size: 14px;
      }

      .toolbar {
      .page-toolbar {
        display: flex;
        align-items: center;
        gap: 12px;
        gap: 10px;
      }

      .toolbar select {
      .page-toolbar select,
      .page-toolbar input {
        border-radius: 10px;
        border: 1px solid #e1e4ea;
        border: 1px solid var(--border);
        padding: 8px 10px;
        font-size: 14px;
        background: #ffffff;
        font-size: 13px;
      }

      .blocks {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .blocks-wrapper {
        position: relative;
      }

      .block {
        background: var(--surface);
        border: 1px solid #edf0f5;
        border-radius: var(--radius);
        padding: 12px 14px;
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 12px 14px;
        border-radius: 12px;
        background: #ffffff;
        border: 1px solid #edf0f5;
        position: relative;
      }

      .block textarea,
      .block [contenteditable="true"] {
        border: none;
      .block.dragging {
        opacity: 0.6;
      }

      .block-handle {
        width: 18px;
        height: 18px;
        border-radius: 6px;
        background: #e2e8f0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: grab;
        color: #64748b;
        font-size: 12px;
      }

      .block-content {
        flex: 1;
        min-width: 0;
      }

      .block-content [contenteditable="true"] {
        outline: none;
        border: none;
        width: 100%;
        font-size: 16px;
        font-family: inherit;
        resize: none;
      }

      .block .heading {
        font-size: 20px;
      .block-content .heading-1 {
        font-size: 26px;
        font-weight: 700;
      }

      .block-content .heading-2 {
        font-size: 22px;
        font-weight: 600;
      }

      .block .checkbox-text {
        flex: 1;
        font-size: 16px;
      .block-content .heading-3 {
        font-size: 18px;
        font-weight: 600;
      }

      .checkbox-items {
      .block-content .quote {
        padding: 10px 12px;
        background: #f1f5f9;
        border-left: 3px solid var(--accent);
        border-radius: 8px;
      }

      .block-content code {
        display: block;
        background: #0f172a;
        color: #e2e8f0;
        padding: 12px;
        border-radius: 10px;
        font-size: 13px;
        white-space: pre-wrap;
      }

      .block-content ul,
      .block-content ol {
        padding-left: 18px;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .checklist {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
      }

      .checkbox-item {
      .checklist-item {
        display: flex;
        align-items: center;
        gap: 10px;
        gap: 8px;
      }

      .checkbox-item input[type="checkbox"] {
        margin: 0;
      .divider {
        width: 100%;
        height: 1px;
        background: #e2e8f0;
      }

      .checkbox-item .item-text {
        flex: 1;
        outline: none;
      .subpage {
        border: 1px dashed #cbd5f5;
        padding: 10px 12px;
        border-radius: 10px;
        background: #f8fafc;
        cursor: pointer;
      }

      .checkbox-actions {
      .table-block {
        border: 1px solid #e2e8f0;
        border-radius: var(--radius);
        overflow: hidden;
      }

      .table-toolbar {
        display: flex;
        justify-content: flex-start;
        justify-content: space-between;
        align-items: center;
        padding: 10px 12px;
        background: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
        gap: 8px;
        flex-wrap: wrap;
      }

      .checkbox-actions button {
        border: 1px dashed #cbd5e1;
        background: transparent;
        color: #475569;
        border-radius: 10px;
        padding: 6px 12px;
        cursor: pointer;
      .table-toolbar input,
      .table-toolbar select {
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        padding: 6px 8px;
        font-size: 12px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }

      .checkbox-actions button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      th,
      td {
        border-bottom: 1px solid #eef2f6;
        padding: 10px;
        text-align: left;
      }

      th {
        background: #f8fafc;
        font-weight: 600;
      }

      .block .delete {
      td input[type="text"],
      td select {
        width: 100%;
        border: none;
        background: transparent;
        color: #9aa3b2;
        font-size: 13px;
      }

      .table-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 12px;
      }

      .table-list-card {
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 10px 12px;
        background: #ffffff;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 8px;
      }

      .toast {
        position: fixed;
        bottom: 24px;
        right: 24px;
        background: #111827;
        color: #fff;
        padding: 10px 14px;
        border-radius: 10px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
      }

      .toast.show {
        opacity: 1;
      }

      .command-palette {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.4);
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding-top: 100px;
        z-index: 20;
      }

      .command-panel {
        width: min(520px, 90vw);
        background: #ffffff;
        border-radius: 14px;
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .command-panel input {
        width: 100%;
        border: none;
        padding: 14px;
        font-size: 15px;
        outline: none;
        border-bottom: 1px solid #e2e8f0;
      }

      .command-list {
        max-height: 320px;
        overflow-y: auto;
      }

      .command-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 14px;
        cursor: pointer;
        font-size: 16px;
      }

      .empty {
        color: #9aa3b2;
        font-size: 14px;
      .command-item.active,
      .command-item:hover {
        background: #eff6ff;
      }

      .slash-menu {
      .inline-toolbar {
        position: absolute;
        min-width: 180px;
        background: #ffffff;
        border: 1px solid #e2e8f0;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
        border-radius: 12px;
        background: #0f172a;
        color: #ffffff;
        padding: 6px;
        z-index: 10;
        border-radius: 10px;
        display: flex;
        gap: 6px;
        z-index: 15;
      }

      .inline-toolbar button {
        background: transparent;
        border: none;
        color: #ffffff;
        cursor: pointer;
        font-size: 12px;
        padding: 4px 6px;
      }

      .slash-menu[hidden] {
        display: none;
      .drop-indicator {
        height: 4px;
        background: var(--accent);
        border-radius: 4px;
        margin: 4px 0;
      }

      .slash-menu-item {
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 16px;
      }

      .dashboard-card {
        background: #ffffff;
        border-radius: var(--radius);
        border: 1px solid #edf0f5;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        flex-direction: column;
        gap: 12px;
      }

      .dashboard-card h3 {
        margin: 0;
        font-size: 14px;
        color: var(--text-muted);
      }

      .dashboard-card button {
        text-align: left;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 8px 10px;
        cursor: pointer;
        font-size: 14px;
      }

      .slash-menu-item.active {
        background: #eef2ff;
        color: #1d4ed8;
      .recent-item {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        color: #0f172a;
      }

      @media (max-width: 900px) {
      @media (max-width: 960px) {
        .app {
          grid-template-columns: 1fr;
        }

        .sidebar {
          border-right: none;
          border-bottom: 1px solid #e1e4ea;
          border-bottom: 1px solid var(--border);
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <aside class="sidebar">
        <h1>Mini Notion</h1>
        <div class="pages" id="pages"></div>
        <button id="add-page">–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</button>
        <div class="workspace">
          <h1>My Space</h1>
          <span class="page-subtitle">Light mode</span>
        </div>
        <div class="search-box">
          <span>üîç</span>
          <input id="global-search" type="text" placeholder="Search pages, blocks, tags" />
        </div>
        <div class="sidebar-actions">
          <button class="primary-button" id="new-page">+ New Page</button>
          <button class="ghost-button" id="open-command">Ctrl + K</button>
        </div>
        <div class="sidebar-section">
          <h2>‚≠ê Favorites</h2>
          <div class="favorites-list" id="favorites-list"></div>
        </div>
        <div class="sidebar-section">
          <h2>Recent</h2>
          <div class="recent-list" id="recent-list"></div>
        </div>
        <div class="sidebar-section">
          <h2>Pages</h2>
          <div class="page-tree" id="page-tree"></div>
        </div>
        <div class="sidebar-section">
          <h2>Tags</h2>
          <div class="tag-list" id="tag-list"></div>
        </div>
        <div class="sidebar-footer">
          <button>Settings</button>
          <button>Trash</button>
        </div>
      </aside>
      <main class="main">
        <input
          id="page-title"
          class="title-input"
          type="text"
          placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"
        />
        <div class="toolbar">
          <select id="block-type">
            <option value="text">–¢–µ–∫—Å—Ç</option>
            <option value="heading">–ó–∞–≥–æ–ª–æ–≤–æ–∫</option>
            <option value="checkbox">–ß–µ–∫–±–æ–∫—Å</option>
          </select>
          <button id="add-block">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
        <div id="dashboard" hidden>
          <div class="top-bar">
            <div>
              <h2>Dashboard</h2>
              <p class="page-subtitle">Quick access to recent work and tasks.</p>
            </div>
          </div>
          <div class="dashboard-grid">
            <div class="dashboard-card">
              <h3>Quick Actions</h3>
              <button data-action="new-note">New Note</button>
              <button data-action="new-task">New Task List</button>
              <button data-action="new-table">New Table</button>
              <button data-action="import">Import MD</button>
            </div>
            <div class="dashboard-card">
              <h3>Recent</h3>
              <div id="dashboard-recent"></div>
            </div>
            <div class="dashboard-card">
              <h3>Pinned</h3>
              <div id="dashboard-pinned"></div>
            </div>
            <div class="dashboard-card">
              <h3>Inbox / Today</h3>
              <div id="dashboard-inbox"></div>
            </div>
          </div>
        </div>
        <div class="blocks-wrapper">
          <div class="blocks" id="blocks"></div>
          <div class="empty" id="empty-state" hidden>
            –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –±–ª–æ–∫, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–∏—Å–∞—Ç—å.
        <div id="page-view">
          <div class="top-bar">
            <div>
              <input class="page-title" id="page-title" placeholder="Untitled" />
              <p class="page-subtitle" id="page-meta"></p>
            </div>
            <div class="page-toolbar">
              <select id="block-type">
                <option value="paragraph">Paragraph</option>
                <option value="heading-1">Heading 1</option>
                <option value="heading-2">Heading 2</option>
                <option value="heading-3">Heading 3</option>
                <option value="bullet">Bullet list</option>
                <option value="numbered">Numbered list</option>
                <option value="checklist">Checklist</option>
                <option value="quote">Quote / Callout</option>
                <option value="divider">Divider</option>
                <option value="code">Code block</option>
                <option value="subpage">Embedded subpage</option>
                <option value="table">Table</option>
              </select>
              <button class="primary-button" id="add-block">Add block</button>
            </div>
          </div>
          <div class="slash-menu" id="slash-menu" hidden></div>
          <div class="tag-chips" id="page-tags"></div>
          <div class="blocks" id="blocks"></div>
        </div>
      </main>
    </div>

    <div class="command-palette" id="command-palette" hidden>
      <div class="command-panel">
        <input id="command-input" placeholder="Type a command or search" />
        <div class="command-list" id="command-list"></div>
      </div>
    </div>

    <div class="inline-toolbar" id="inline-toolbar" hidden>
      <button data-command="bold"><strong>B</strong></button>
      <button data-command="italic"><em>I</em></button>
      <button data-command="createLink">Link</button>
      <button data-command="code">Code</button>
      <button data-command="highlight">Highlight</button>
    </div>

    <div class="toast" id="toast"></div>

    <script>
      const STORAGE_KEY = "mini-notion-data";
      const pagesContainer = document.getElementById("pages");
      const addPageButton = document.getElementById("add-page");
      const STORAGE_KEY = "mini-notion-state";
      const pagesContainer = document.getElementById("page-tree");
      const favoritesList = document.getElementById("favorites-list");
      const recentList = document.getElementById("recent-list");
      const tagList = document.getElementById("tag-list");
      const dashboard = document.getElementById("dashboard");
      const pageView = document.getElementById("page-view");
      const pageTitleInput = document.getElementById("page-title");
      const pageMeta = document.getElementById("page-meta");
      const pageTags = document.getElementById("page-tags");
      const blocksContainer = document.getElementById("blocks");
      const blockTypeSelect = document.getElementById("block-type");
      const addBlockButton = document.getElementById("add-block");
      const blocksContainer = document.getElementById("blocks");
      const emptyState = document.getElementById("empty-state");
      const slashMenu = document.getElementById("slash-menu");
      const blocksWrapper = document.querySelector(".blocks-wrapper");
      const newPageButton = document.getElementById("new-page");
      const globalSearch = document.getElementById("global-search");
      const commandPalette = document.getElementById("command-palette");
      const commandInput = document.getElementById("command-input");
      const commandList = document.getElementById("command-list");
      const toast = document.getElementById("toast");
      const inlineToolbar = document.getElementById("inline-toolbar");
      const openCommandButton = document.getElementById("open-command");
      const dashboardRecent = document.getElementById("dashboard-recent");
      const dashboardPinned = document.getElementById("dashboard-pinned");
      const dashboardInbox = document.getElementById("dashboard-inbox");

      const generateId = (prefix) =>
        `${prefix}-${Math.random().toString(36).slice(2, 9)}`;

      const now = () => new Date().toISOString();

      const sampleTable = () => ({
        columns: [
          { id: "name", name: "Name", type: "text" },
          {
            id: "status",
            name: "Status",
            type: "select",
            options: ["Backlog", "In progress", "Done"],
          },
          {
            id: "tag",
            name: "Tag",
            type: "multi",
            options: ["Design", "Product", "Ops"],
          },
          { id: "due", name: "Due", type: "date" },
          { id: "done", name: "Done", type: "checkbox" },
        ],
        rows: [
          {
            id: generateId("row"),
            cells: {
              name: "Landing refresh",
              status: "In progress",
              tag: ["Design"],
              due: "2024-06-18",
              done: false,
            },
          },
          {
            id: generateId("row"),
            cells: {
              name: "Release checklist",
              status: "Backlog",
              tag: ["Ops"],
              due: "2024-06-22",
              done: false,
            },
          },
        ],
        filters: { search: "", status: "", tag: "" },
        view: "table",
      });

      const defaultState = () => ({
        activePageId: "page-1",
        activePageId: "home",
        lastOpened: "home",
        pages: [
          {
            id: "home",
            title: "Home",
            favorite: true,
            tags: ["dashboard"],
            parentId: null,
            updatedAt: now(),
            blocks: [],
            type: "dashboard",
          },
          {
            id: "page-1",
            title: "–ú–æ—è –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",
            title: "Product brief",
            favorite: true,
            tags: ["work", "launch"],
            parentId: null,
            updatedAt: now(),
            blocks: [
              {
                id: generateId("block"),
                type: "heading-1",
                content: "Launch overview",
              },
              {
                id: generateId("block"),
                type: "paragraph",
                content:
                  "Mini-Notion focuses on clarity, speed, and lightweight workflow capture.",
              },
              {
                id: generateId("block"),
                type: "checklist",
                items: [
                  { id: generateId("item"), text: "Define scope", checked: true },
                  { id: generateId("item"), text: "Review with team", checked: false },
                ],
              },
              {
                id: generateId("block"),
                type: "quote",
                content: "Less surface area, more execution focus.",
              },
              { id: generateId("block"), type: "divider" },
              {
                id: generateId("block"),
                type: "table",
                table: sampleTable(),
              },
            ],
          },
          {
            id: "page-2",
            title: "Design System",
            favorite: false,
            tags: ["design"],
            parentId: null,
            updatedAt: now(),
            blocks: [
              {
                id: generateId("block"),
                type: "heading-2",
                content: "Tokens",
              },
              {
                id: generateId("block"),
                type: "bullet",
                items: [
                  { id: generateId("item"), text: "Primary #3B82F6" },
                  { id: generateId("item"), text: "Radius 12px" },
                ],
              },
              {
                id: generateId("block"),
                type: "code",
                content: "body { font-family: Inter; }",
              },
            ],
          },
          {
            id: "page-3",
            title: "Sprint planning",
            favorite: false,
            tags: ["work", "tasks"],
            parentId: "page-1",
            updatedAt: now(),
            blocks: [
              { id: "block-1", type: "heading", content: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å" },
              {
                id: "block-2",
                type: "text",
                content: "–≠—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–º–µ—Ç–æ–∫ –≤ —Å—Ç–∏–ª–µ Notion.",
                id: generateId("block"),
                type: "paragraph",
                content: "Weekly sprint goals and priorities.",
              },
              {
                id: "block-3",
                type: "checkbox",
                content: "–°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Å–ø–∏—Å–æ–∫",
                checked: false,
                id: generateId("block"),
                type: "numbered",
                items: [
                  { id: generateId("item"), text: "Finalize backlog" },
                  { id: generateId("item"), text: "Assign owners" },
                ],
              },
            ],
          },
        ],
        tags: ["work", "launch", "design", "tasks", "dashboard"],
        recent: ["page-1", "page-2", "page-3"],
        pinned: ["page-1"],
      });

      const loadState = () => {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) {
          return defaultState();
        }
        if (!saved) return defaultState();
        try {
          return JSON.parse(saved);
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage", error);
          console.error("Failed to parse saved state", error);
          return defaultState();
        }
      };

      let state = loadState();
      const slashOptions = [
        { type: "text", label: "–¢–µ–∫—Å—Ç" },
        { type: "heading", label: "–ó–∞–≥–æ–ª–æ–≤–æ–∫" },
        { type: "checkbox", label: "–ß–µ–∫–±–æ–∫—Å" },
      ];
      const slashState = {
        open: false,
        blockId: null,
        selectedIndex: 0,
        position: { x: 0, y: 0 },
      };
      let draggingBlockId = null;
      let draggingPageId = null;
      let dropIndicator = null;
      let commandIndex = 0;

      const saveState = () => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      };

      const generateId = (prefix) =>
        `${prefix}-${Math.random().toString(36).slice(2, 9)}`;

      const getActivePage = () =>
        state.pages.find((page) => page.id === state.activePageId);
      const showToast = (message) => {
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 2000);
      };

      const setActivePage = (pageId) => {
        state.activePageId = pageId;
        state.lastOpened = pageId;
        const recent = state.recent.filter((id) => id !== pageId);
        recent.unshift(pageId);
        state.recent = recent.slice(0, 8);
        saveState();
        render();
      };

      const addPage = () => {
      const getActivePage = () =>
        state.pages.find((page) => page.id === state.activePageId);

      const addPage = ({ title = "Untitled", parentId = null } = {}) => {
        const newPage = {
          id: generateId("page"),
          title: "–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",
          blocks: [],
          title,
          favorite: false,
          tags: [],
          parentId,
          updatedAt: now(),
          blocks: [
            {
              id: generateId("block"),
              type: "paragraph",
              content: "Start typing your notes here...",
            },
          ],
        };
        state.pages.unshift(newPage);
        state.activePageId = newPage.id;
        saveState();
        render();
        setActivePage(newPage.id);
        setTimeout(() => pageTitleInput.focus(), 0);
        showToast("New page created");
      };

      const deletePage = (pageId) => {
        if (state.pages.length === 1) {
          return;
        }
        state.pages = state.pages.filter((page) => page.id !== pageId);
        if (state.activePageId === pageId) {
          state.activePageId = state.pages[0].id;
        }
      const updatePageTitle = (value) => {
        const page = getActivePage();
        if (!page) return;
        page.title = value;
        page.updatedAt = now();
        saveState();
        render();
        renderSidebar();
      };

      const addBlock = (type) => {
      const updatePageTags = (tag) => {
        const page = getActivePage();
        if (!page) return;
        const newBlock = {
          id: generateId("block"),
          type,
          content:
            type === "heading"
              ? "–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫"
              : type === "checkbox"
                ? undefined
                : "–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç",
          checked: type === "checkbox" ? false : undefined,
          items:
            type === "checkbox"
              ? [
                  {
                    id: generateId("item"),
                    text: "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç",
                    checked: false,
                  },
                ]
              : undefined,
        };
        page.blocks.push(newBlock);
        if (page.tags.includes(tag)) {
          page.tags = page.tags.filter((item) => item !== tag);
        } else {
          page.tags.push(tag);
        }
        page.updatedAt = now();
        saveState();
        render();
      };

      const deleteBlock = (blockId) => {
      const addBlock = (type) => {
        const page = getActivePage();
        if (!page) return;
        page.blocks = page.blocks.filter((block) => block.id !== blockId);
        if (!page || page.type === "dashboard") return;
        const base = { id: generateId("block"), type };
        if (["paragraph", "heading-1", "heading-2", "heading-3", "quote"].includes(type)) {
          base.content = type.startsWith("heading")
            ? "New heading"
            : type === "quote"
              ? "Callout text"
              : "New text";
        }
        if (["bullet", "numbered", "checklist"].includes(type)) {
          base.items = [
            { id: generateId("item"), text: "List item", checked: false },
          ];
        }
        if (type === "code") {
          base.content = "// Code snippet";
        }
        if (type === "subpage") {
          base.pageId = state.pages.find((item) => item.id !== "home")?.id || "";
        }
        if (type === "table") {
          base.table = sampleTable();
        }
        page.blocks.push(base);
        page.updatedAt = now();
        saveState();
        render();
        renderBlocks();
      };

      const updateBlockContent = (blockId, content) => {
        const page = getActivePage();
        if (!page) return;
        const block = page.blocks.find((item) => item.id === blockId);
        if (!block) return;
        if (block.type === "checkbox") return;
        block.content = content;
        page.updatedAt = now();
        saveState();
      };

      const updateBlockChecked = (blockId, checked) => {
      const updateBlockItem = (blockId, itemId, content) => {
        const page = getActivePage();
        if (!page) return;
        const block = page.blocks.find((item) => item.id === blockId);
        if (!block) return;
        block.checked = checked;
        if (!block || !block.items) return;
        const item = block.items.find((entry) => entry.id === itemId);
        if (!item) return;
        item.text = content;
        page.updatedAt = now();
        saveState();
      };

      const updateCheckboxItemContent = (blockId, itemId, text) => {
      const updateBlockItemChecked = (blockId, itemId, checked) => {
        const page = getActivePage();
        if (!page) return;
        const block = page.blocks.find((item) => item.id === blockId);
        if (!block || block.type !== "checkbox") return;
        const item = block.items?.find((entry) => entry.id === itemId);
        if (!block || !block.items) return;
        const item = block.items.find((entry) => entry.id === itemId);
        if (!item) return;
        item.text = text;
        item.checked = checked;
        page.updatedAt = now();
        saveState();
      };

      const updateCheckboxItemChecked = (blockId, itemId, checked) => {
      const addListItem = (blockId) => {
        const page = getActivePage();
        if (!page) return;
        const block = page.blocks.find((item) => item.id === blockId);
        if (!block || block.type !== "checkbox") return;
        const item = block.items?.find((entry) => entry.id === itemId);
        if (!item) return;
        item.checked = checked;
        if (!block || !block.items) return;
        block.items.push({ id: generateId("item"), text: "New item", checked: false });
        page.updatedAt = now();
        saveState();
        renderBlocks();
      };

      const addCheckboxItem = (blockId) => {
      const deleteBlock = (blockId) => {
        const page = getActivePage();
        if (!page) return;
        const block = page.blocks.find((item) => item.id === blockId);
        if (!block || block.type !== "checkbox") return;
        if (!block.items) block.items = [];
        if (block.items.length >= 10) return;
        block.items.push({
          id: generateId("item"),
          text: "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç",
          checked: false,
        });
        page.blocks = page.blocks.filter((block) => block.id !== blockId);
        page.updatedAt = now();
        saveState();
        render();
        focusBlock(blockId, block.items.length - 1);
        renderBlocks();
        showToast("Block deleted");
      };

      const changeBlockType = (blockId, type) => {
      const moveBlock = (sourceId, targetId) => {
        const page = getActivePage();
        if (!page) return;
        const block = page.blocks.find((item) => item.id === blockId);
        if (!block || block.type === type) return;
        if (type === "checkbox") {
          const existingText =
            block.content ||
            (block.items && block.items[0] ? block.items[0].text : "") ||
            "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç";
          block.type = "checkbox";
          block.items = [
            { id: generateId("item"), text: existingText, checked: false },
          ];
          delete block.content;
          delete block.checked;
        } else {
          const existingText =
            block.content ||
            (block.items && block.items[0] ? block.items[0].text : "");
          block.type = type;
          block.content =
            existingText || (type === "heading" ? "–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫" : "–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç");
          delete block.items;
          delete block.checked;
        }
        const blocks = page.blocks;
        const sourceIndex = blocks.findIndex((block) => block.id === sourceId);
        const targetIndex = blocks.findIndex((block) => block.id === targetId);
        if (sourceIndex < 0 || targetIndex < 0) return;
        const [moved] = blocks.splice(sourceIndex, 1);
        blocks.splice(targetIndex, 0, moved);
        saveState();
        render();
        focusBlock(blockId);
        renderBlocks();
      };

      const normalizeCheckboxBlock = (block) => {
        if (block.type !== "checkbox") return false;
        if (!Array.isArray(block.items)) {
          block.items = [
            {
              id: generateId("item"),
              text: block.content || "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç",
              checked: Boolean(block.checked),
            },
          ];
          delete block.content;
          delete block.checked;
          return true;
        }
        let updated = false;
        block.items = block.items.map((item) => {
          if (!item.id) {
            updated = true;
            return { ...item, id: generateId("item") };
      const renderPageTree = (pages, parentId = null) => {
        const nodes = pages.filter((page) => page.parentId === parentId);
        return nodes.map((page) => {
          const wrapper = document.createElement("div");
          wrapper.className = "page-item";
          if (page.id === state.activePageId) wrapper.classList.add("active");
          wrapper.draggable = page.id !== "home";
          wrapper.dataset.pageId = page.id;

          const toggle = document.createElement("button");
          toggle.className = "tree-toggle";
          toggle.textContent = "‚ñ∏";
          const hasChildren = pages.some((item) => item.parentId === page.id);
          toggle.style.visibility = hasChildren ? "visible" : "hidden";
          wrapper.appendChild(toggle);

          const label = document.createElement("span");
          label.className = "label";
          label.textContent = page.title;
          wrapper.appendChild(label);

          if (page.favorite) {
            const star = document.createElement("span");
            star.className = "star";
            star.textContent = "‚òÖ";
            wrapper.appendChild(star);
          }
          return item;
        });
        return updated;
      };

      const getCaretRect = (fallbackElement) => {
        const selection = window.getSelection();
        if (selection && selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          const rect = range.getBoundingClientRect();
          if (rect && (rect.top || rect.left || rect.width || rect.height)) {
            return rect;
          wrapper.addEventListener("click", () => setActivePage(page.id));
          wrapper.addEventListener("dragstart", () => {
            draggingPageId = page.id;
          });
          wrapper.addEventListener("dragover", (event) => {
            event.preventDefault();
          });
          wrapper.addEventListener("drop", () => {
            if (!draggingPageId || draggingPageId === page.id) return;
            const dragged = state.pages.find((item) => item.id === draggingPageId);
            if (!dragged) return;
            dragged.parentId = page.parentId;
            const updated = state.pages.filter((item) => item.id !== draggingPageId);
            const targetIndex = updated.findIndex((item) => item.id === page.id);
            updated.splice(targetIndex, 0, dragged);
            state.pages = updated;
            saveState();
            renderSidebar();
            showToast("Page reordered");
          });

          const children = pages.filter((item) => item.parentId === page.id);
          if (children.length > 0) {
            const childContainer = document.createElement("div");
            childContainer.className = "children";
            renderPageTree(pages, page.id).forEach((child) => childContainer.appendChild(child));
            wrapper.appendChild(childContainer);
          }
        }
        return fallbackElement.getBoundingClientRect();
      };

      const positionSlashMenu = () => {
        const wrapperRect = blocksWrapper.getBoundingClientRect();
        slashMenu.style.left = `${slashState.position.x - wrapperRect.left}px`;
        slashMenu.style.top = `${slashState.position.y - wrapperRect.top}px`;
          return wrapper;
        });
      };

      const openSlashMenu = (blockId, rect) => {
        slashState.open = true;
        slashState.blockId = blockId;
        slashState.selectedIndex = 0;
        slashState.position = {
          x: rect.left,
          y: rect.bottom + 8,
        };
        renderSlashMenu();
        slashMenu.hidden = false;
        positionSlashMenu();
      };
      const renderSidebar = () => {
        const searchTerm = globalSearch.value.trim().toLowerCase();
        const pages = state.pages.filter((page) =>
          page.title.toLowerCase().includes(searchTerm)
        );

      const closeSlashMenu = () => {
        slashState.open = false;
        slashState.blockId = null;
        slashMenu.hidden = true;
      };
        pagesContainer.innerHTML = "";
        renderPageTree(pages).forEach((node) => pagesContainer.appendChild(node));

        favoritesList.innerHTML = "";
        state.pages
          .filter((page) => page.favorite && page.id !== "home")
          .forEach((page) => {
            const item = document.createElement("div");
            item.className = "page-item";
            item.textContent = page.title;
            item.addEventListener("click", () => setActivePage(page.id));
            favoritesList.appendChild(item);
          });

      const renderSlashMenu = () => {
        slashMenu.innerHTML = "";
        slashOptions.forEach((option, index) => {
        recentList.innerHTML = "";
        state.recent.forEach((id) => {
          const page = state.pages.find((item) => item.id === id);
          if (!page) return;
          const item = document.createElement("div");
          item.className = `slash-menu-item${
            slashState.selectedIndex === index ? " active" : ""
          }`;
          item.textContent = option.label;
          item.className = "page-item";
          item.innerHTML = `<span class="label">${page.title}</span><span class="meta">${new Date(
            page.updatedAt
          ).toLocaleDateString()}</span>`;
          item.addEventListener("click", () => setActivePage(page.id));
          recentList.appendChild(item);
        });

        tagList.innerHTML = "";
        state.tags.forEach((tag) => {
          const item = document.createElement("div");
          item.className = "page-item";
          item.textContent = `#${tag}`;
          item.addEventListener("click", () => {
            changeBlockType(slashState.blockId, option.type);
            closeSlashMenu();
            globalSearch.value = tag;
            renderSidebar();
          });
          slashMenu.appendChild(item);
          tagList.appendChild(item);
        });
      };

      const focusBlock = (blockId, itemIndex = 0) => {
        const selector = `[data-block-id=\"${blockId}\"]`;
        const blockElement = document.querySelector(selector);
        if (!blockElement) return;
        const checkboxItems = blockElement.querySelectorAll(
          ".checkbox-item .item-text"
        );
        if (checkboxItems.length > 0) {
          const target = checkboxItems[itemIndex] || checkboxItems[0];
          target.focus();
          return;
        }
        const editable = blockElement.querySelector("[contenteditable=\"true\"]");
        if (editable) {
          editable.focus();
        }
      };

      const updatePageTitle = (title) => {
      const renderTags = () => {
        const page = getActivePage();
        if (!page) return;
        page.title = title;
        saveState();
        renderPages();
        pageTags.innerHTML = "";
        if (!page || page.type === "dashboard") return;
        state.tags.forEach((tag) => {
          const chip = document.createElement("button");
          chip.className = `tag-chip${page.tags.includes(tag) ? " active" : ""}`;
          chip.textContent = `#${tag}`;
          chip.addEventListener("click", () => updatePageTags(tag));
          pageTags.appendChild(chip);
        });
      };

      const renderPages = () => {
        pagesContainer.innerHTML = "";
        state.pages.forEach((page) => {
          const item = document.createElement("div");
          item.className = `page-item${
            page.id === state.activePageId ? " active" : ""
          }`;

          const title = document.createElement("span");
          title.textContent = page.title || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
          item.appendChild(title);

          const removeButton = document.createElement("button");
          removeButton.textContent = "√ó";
          removeButton.title = "–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É";
          removeButton.addEventListener("click", (event) => {
            event.stopPropagation();
            deletePage(page.id);
          });
          item.appendChild(removeButton);
      const renderDashboard = () => {
        dashboardRecent.innerHTML = "";
        state.recent.slice(0, 5).forEach((id) => {
          const page = state.pages.find((item) => item.id === id);
          if (!page) return;
          const row = document.createElement("div");
          row.className = "recent-item";
          row.innerHTML = `<span>üìÑ ${page.title}</span><span>${new Date(
            page.updatedAt
          ).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })}</span>`;
          row.addEventListener("click", () => setActivePage(page.id));
          dashboardRecent.appendChild(row);
        });

          item.addEventListener("click", () => setActivePage(page.id));
          pagesContainer.appendChild(item);
        dashboardPinned.innerHTML = "";
        state.pinned.forEach((id) => {
          const page = state.pages.find((item) => item.id === id);
          if (!page) return;
          const row = document.createElement("div");
          row.className = "recent-item";
          row.textContent = `üìå ${page.title}`;
          row.addEventListener("click", () => setActivePage(page.id));
          dashboardPinned.appendChild(row);
        });

        dashboardInbox.innerHTML = "";
        state.pages
          .filter((page) => page.tags.includes("tasks"))
          .slice(0, 4)
          .forEach((page) => {
            const row = document.createElement("div");
            row.className = "recent-item";
            row.textContent = `‚úÖ ${page.title}`;
            row.addEventListener("click", () => setActivePage(page.id));
            dashboardInbox.appendChild(row);
          });
      };

      const renderBlocks = () => {
        const page = getActivePage();
        blocksContainer.innerHTML = "";
        if (!page || page.blocks.length === 0) {
          emptyState.hidden = false;
          return;
        }
        emptyState.hidden = true;
        if (!page || page.type === "dashboard") return;

        page.blocks.forEach((block) => {
          const row = document.createElement("div");
          row.className = "block";
          row.dataset.blockId = block.id;
          row.draggable = true;

          if (block.type === "checkbox") {
            const updated = normalizeCheckboxBlock(block);
            if (updated) {
              saveState();
            }
            const items = document.createElement("div");
            items.className = "checkbox-items";
          const handle = document.createElement("div");
          handle.className = "block-handle";
          handle.textContent = "‚ãÆ‚ãÆ";
          row.appendChild(handle);

          const content = document.createElement("div");
          content.className = "block-content";

          if (["paragraph", "heading-1", "heading-2", "heading-3"].includes(block.type)) {
            const text = document.createElement("div");
            text.contentEditable = "true";
            text.textContent = block.content || "";
            text.className = block.type;
            text.addEventListener("input", (event) => {
              updateBlockContent(block.id, event.target.textContent.trim());
            });
            text.addEventListener("keydown", (event) => handleMarkdownShortcuts(event, block));
            content.appendChild(text);
          }

          if (block.type === "quote") {
            const quote = document.createElement("div");
            quote.className = "quote";
            quote.contentEditable = "true";
            quote.textContent = block.content || "";
            quote.addEventListener("input", (event) => {
              updateBlockContent(block.id, event.target.textContent.trim());
            });
            content.appendChild(quote);
          }

            block.items.forEach((item) => {
              const itemRow = document.createElement("div");
              itemRow.className = "checkbox-item";
          if (["bullet", "numbered"].includes(block.type)) {
            const list = document.createElement(block.type === "bullet" ? "ul" : "ol");
            block.items?.forEach((item) => {
              const li = document.createElement("li");
              const editable = document.createElement("div");
              editable.contentEditable = "true";
              editable.textContent = item.text;
              editable.addEventListener("input", (event) => {
                updateBlockItem(block.id, item.id, event.target.textContent.trim());
              });
              li.appendChild(editable);
              list.appendChild(li);
            });
            const addButton = document.createElement("button");
            addButton.className = "ghost-button";
            addButton.textContent = "+ Add item";
            addButton.addEventListener("click", () => addListItem(block.id));
            content.appendChild(list);
            content.appendChild(addButton);
          }

          if (block.type === "checklist") {
            const checklist = document.createElement("div");
            checklist.className = "checklist";
            block.items?.forEach((item) => {
              const rowItem = document.createElement("div");
              rowItem.className = "checklist-item";
              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.checked = Boolean(item.checked);
              checkbox.addEventListener("change", (event) => {
                updateCheckboxItemChecked(block.id, item.id, event.target.checked);
                updateBlockItemChecked(block.id, item.id, event.target.checked);
              });
              itemRow.appendChild(checkbox);

              const text = document.createElement("div");
              text.className = "item-text";
              text.contentEditable = "true";
              text.textContent = item.text;
              text.addEventListener("input", (event) => {
                updateCheckboxItemContent(
                  block.id,
                  item.id,
                  event.target.textContent.trim()
                );
              const editable = document.createElement("div");
              editable.contentEditable = "true";
              editable.textContent = item.text;
              editable.addEventListener("input", (event) => {
                updateBlockItem(block.id, item.id, event.target.textContent.trim());
              });
              itemRow.appendChild(text);
              items.appendChild(itemRow);
              rowItem.appendChild(checkbox);
              rowItem.appendChild(editable);
              checklist.appendChild(rowItem);
            });
            const addButton = document.createElement("button");
            addButton.className = "ghost-button";
            addButton.textContent = "+ Add task";
            addButton.addEventListener("click", () => addListItem(block.id));
            content.appendChild(checklist);
            content.appendChild(addButton);
          }

            const actions = document.createElement("div");
            actions.className = "checkbox-actions";
            const addItemButton = document.createElement("button");
            addItemButton.type = "button";
            addItemButton.textContent = "–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç";
            addItemButton.disabled = block.items.length >= 10;
            addItemButton.addEventListener("click", () => addCheckboxItem(block.id));
            actions.appendChild(addItemButton);
            items.appendChild(actions);

            row.appendChild(items);
          } else {
            const text = document.createElement("div");
            text.contentEditable = "true";
            text.textContent = block.content;
            if (block.type === "heading") {
              text.classList.add("heading");
            }
            text.addEventListener("keydown", (event) => {
              if (
                event.key === "/" &&
                text.textContent.trim() === "" &&
                !event.shiftKey
              ) {
                event.preventDefault();
                openSlashMenu(block.id, getCaretRect(text));
              }
            });
            text.addEventListener("input", (event) => {
          if (block.type === "divider") {
            const divider = document.createElement("div");
            divider.className = "divider";
            content.appendChild(divider);
          }

          if (block.type === "code") {
            const code = document.createElement("code");
            code.contentEditable = "true";
            code.textContent = block.content || "";
            code.addEventListener("input", (event) => {
              updateBlockContent(block.id, event.target.textContent.trim());
            });
            row.appendChild(text);
            content.appendChild(code);
          }

          if (block.type === "subpage") {
            const subpage = document.createElement("div");
            subpage.className = "subpage";
            const target = state.pages.find((page) => page.id === block.pageId);
            subpage.textContent = target ? `Embedded: ${target.title}` : "Select a page";
            subpage.addEventListener("click", () => {
              if (target) setActivePage(target.id);
            });
            content.appendChild(subpage);
          }

          if (block.type === "table") {
            const tableBlock = document.createElement("div");
            tableBlock.className = "table-block";
            const table = block.table;

            const toolbar = document.createElement("div");
            toolbar.className = "table-toolbar";

            const search = document.createElement("input");
            search.placeholder = "Search table";
            search.value = table.filters.search;
            search.addEventListener("input", (event) => {
              table.filters.search = event.target.value;
              saveState();
              renderBlocks();
            });

            const statusFilter = document.createElement("select");
            statusFilter.innerHTML =
              '<option value="">All Status</option>' +
              table.columns
                .find((col) => col.id === "status")
                .options.map((opt) => `<option value="${opt}">${opt}</option>`)
                .join("");
            statusFilter.value = table.filters.status;
            statusFilter.addEventListener("change", (event) => {
              table.filters.status = event.target.value;
              saveState();
              renderBlocks();
            });

            const tagFilter = document.createElement("select");
            tagFilter.innerHTML =
              '<option value="">All Tags</option>' +
              table.columns
                .find((col) => col.id === "tag")
                .options.map((opt) => `<option value="${opt}">${opt}</option>`)
                .join("");
            tagFilter.value = table.filters.tag;
            tagFilter.addEventListener("change", (event) => {
              table.filters.tag = event.target.value;
              saveState();
              renderBlocks();
            });

            const viewToggle = document.createElement("select");
            viewToggle.innerHTML =
              '<option value="table">Table</option><option value="list">List</option>';
            viewToggle.value = table.view;
            viewToggle.addEventListener("change", (event) => {
              table.view = event.target.value;
              saveState();
              renderBlocks();
            });

            toolbar.appendChild(search);
            toolbar.appendChild(statusFilter);
            toolbar.appendChild(tagFilter);
            toolbar.appendChild(viewToggle);
            tableBlock.appendChild(toolbar);

            const matchesFilters = (row) => {
              const name = row.cells.name.toLowerCase();
              if (table.filters.search && !name.includes(table.filters.search.toLowerCase())) {
                return false;
              }
              if (table.filters.status && row.cells.status !== table.filters.status) {
                return false;
              }
              if (table.filters.tag) {
                return row.cells.tag.includes(table.filters.tag);
              }
              return true;
            };

            const filteredRows = table.rows.filter(matchesFilters);

            if (table.view === "table") {
              const tableElement = document.createElement("table");
              const head = document.createElement("thead");
              const headRow = document.createElement("tr");
              table.columns.forEach((column) => {
                const th = document.createElement("th");
                th.textContent = column.name;
                headRow.appendChild(th);
              });
              head.appendChild(headRow);
              tableElement.appendChild(head);

              const body = document.createElement("tbody");
              filteredRows.forEach((rowItem) => {
                const rowEl = document.createElement("tr");
                table.columns.forEach((column) => {
                  const td = document.createElement("td");
                  if (column.type === "checkbox") {
                    const input = document.createElement("input");
                    input.type = "checkbox";
                    input.checked = Boolean(rowItem.cells[column.id]);
                    input.addEventListener("change", (event) => {
                      rowItem.cells[column.id] = event.target.checked;
                      saveState();
                    });
                    td.appendChild(input);
                  } else if (column.type === "select") {
                    const select = document.createElement("select");
                    column.options.forEach((opt) => {
                      const option = document.createElement("option");
                      option.value = opt;
                      option.textContent = opt;
                      select.appendChild(option);
                    });
                    select.value = rowItem.cells[column.id];
                    select.addEventListener("change", (event) => {
                      rowItem.cells[column.id] = event.target.value;
                      saveState();
                    });
                    td.appendChild(select);
                  } else if (column.type === "multi") {
                    const input = document.createElement("input");
                    input.type = "text";
                    input.value = rowItem.cells[column.id].join(", ");
                    input.addEventListener("input", (event) => {
                      rowItem.cells[column.id] = event.target.value
                        .split(",")
                        .map((val) => val.trim())
                        .filter(Boolean);
                      saveState();
                    });
                    td.appendChild(input);
                  } else {
                    const input = document.createElement("input");
                    input.type = column.type === "date" ? "date" : "text";
                    input.value = rowItem.cells[column.id];
                    input.addEventListener("input", (event) => {
                      rowItem.cells[column.id] = event.target.value;
                      saveState();
                    });
                    td.appendChild(input);
                  }
                  rowEl.appendChild(td);
                });
                body.appendChild(rowEl);
              });
              tableElement.appendChild(body);
              tableBlock.appendChild(tableElement);
            } else {
              const list = document.createElement("div");
              list.className = "table-list";
              filteredRows.forEach((rowItem) => {
                const card = document.createElement("div");
                card.className = "table-list-card";
                table.columns.forEach((column) => {
                  const cell = document.createElement("div");
                  const value = Array.isArray(rowItem.cells[column.id])
                    ? rowItem.cells[column.id].join(", ")
                    : rowItem.cells[column.id];
                  cell.innerHTML = `<strong>${column.name}</strong><br />${value}`;
                  card.appendChild(cell);
                });
                list.appendChild(card);
              });
              tableBlock.appendChild(list);
            }

            const addRow = document.createElement("button");
            addRow.className = "ghost-button";
            addRow.textContent = "+ Add row";
            addRow.addEventListener("click", () => {
              table.rows.push({
                id: generateId("row"),
                cells: {
                  name: "New item",
                  status: "Backlog",
                  tag: [],
                  due: "",
                  done: false,
                },
              });
              saveState();
              renderBlocks();
            });
            tableBlock.appendChild(addRow);
            content.appendChild(tableBlock);
          }

          row.appendChild(content);

          const deleteButton = document.createElement("button");
          deleteButton.className = "delete";
          deleteButton.textContent = "–£–¥–∞–ª–∏—Ç—å";
          deleteButton.className = "ghost-button";
          deleteButton.textContent = "Delete";
          deleteButton.addEventListener("click", () => deleteBlock(block.id));
          row.appendChild(deleteButton);

          row.addEventListener("dragstart", () => {
            draggingBlockId = block.id;
            row.classList.add("dragging");
          });
          row.addEventListener("dragend", () => {
            draggingBlockId = null;
            row.classList.remove("dragging");
            if (dropIndicator) dropIndicator.remove();
          });
          row.addEventListener("dragover", (event) => {
            event.preventDefault();
            const target = event.currentTarget;
            if (!dropIndicator) {
              dropIndicator = document.createElement("div");
              dropIndicator.className = "drop-indicator";
            }
            target.parentNode.insertBefore(dropIndicator, target);
          });
          row.addEventListener("drop", (event) => {
            event.preventDefault();
            if (!draggingBlockId || draggingBlockId === block.id) return;
            moveBlock(draggingBlockId, block.id);
            if (dropIndicator) dropIndicator.remove();
          });

          blocksContainer.appendChild(row);
        });
      };

      const render = () => {
        closeSlashMenu();
        renderPages();
      const handleMarkdownShortcuts = (event, block) => {
        if (event.key !== " " || !event.target.textContent) return;
        const text = event.target.textContent;
        const trimmed = text.trim();
        const map = {
          "#": "heading-1",
          "##": "heading-2",
          "###": "heading-3",
          "-": "bullet",
          "1.": "numbered",
          "[]": "checklist",
          ">": "quote",
        };
        const targetType = map[trimmed];
        if (!targetType) return;
        event.preventDefault();
        block.type = targetType;
        block.content = "";
        if (["bullet", "numbered", "checklist"].includes(targetType)) {
          block.items = [{ id: generateId("item"), text: "", checked: false }];
        }
        saveState();
        renderBlocks();
      };

      const renderPage = () => {
        const page = getActivePage();
        pageTitleInput.value = page ? page.title : "";
        if (!page) return;
        if (page.type === "dashboard") {
          dashboard.hidden = false;
          pageView.hidden = true;
          renderDashboard();
          return;
        }
        dashboard.hidden = true;
        pageView.hidden = false;
        pageTitleInput.value = page.title;
        pageMeta.textContent = `Last edited ${new Date(page.updatedAt).toLocaleString()}`;
        renderTags();
        renderBlocks();
      };

      addPageButton.addEventListener("click", addPage);
      addBlockButton.addEventListener("click", () =>
        addBlock(blockTypeSelect.value)
      );
      pageTitleInput.addEventListener("input", (event) =>
        updatePageTitle(event.target.value)
      );
      document.addEventListener("click", (event) => {
        if (!slashState.open) return;
        if (slashMenu.contains(event.target)) return;
        closeSlashMenu();
      });
      const renderCommandPalette = () => {
        const query = commandInput.value.toLowerCase();
        const options = [];
        options.push({
          label: "Create new page",
          action: () => addPage({ title: "New page" }),
        });
        options.push({
          label: "Insert block",
          action: () => addBlock(blockTypeSelect.value),
        });
        options.push({
          label: "Add task",
          action: () => addBlock("checklist"),
        });
        state.pages.forEach((page) => {
          options.push({
            label: `Open ${page.title}`,
            action: () => setActivePage(page.id),
          });
        });

        const filtered = options.filter((opt) => opt.label.toLowerCase().includes(query));
        commandList.innerHTML = "";
        filtered.forEach((option, index) => {
          const item = document.createElement("div");
          item.className = `command-item${index === commandIndex ? " active" : ""}`;
          item.textContent = option.label;
          item.addEventListener("click", () => {
            option.action();
            closeCommandPalette();
          });
          commandList.appendChild(item);
        });
      };

      const openCommandPalette = () => {
        commandPalette.hidden = false;
        commandInput.value = "";
        commandIndex = 0;
        renderCommandPalette();
        commandInput.focus();
      };

      const closeCommandPalette = () => {
        commandPalette.hidden = true;
      };

      const renderInlineToolbar = () => {
        const selection = window.getSelection();
        if (!selection || selection.rangeCount === 0) {
          inlineToolbar.hidden = true;
          return;
        }
        const range = selection.getRangeAt(0);
        if (selection.isCollapsed) {
          inlineToolbar.hidden = true;
          return;
        }
        const rect = range.getBoundingClientRect();
        inlineToolbar.style.top = `${rect.top + window.scrollY - 42}px`;
        inlineToolbar.style.left = `${rect.left + window.scrollX}px`;
        inlineToolbar.hidden = false;
      };

      const render = () => {
        renderSidebar();
        renderPage();
      };

      newPageButton.addEventListener("click", () => addPage());
      addBlockButton.addEventListener("click", () => addBlock(blockTypeSelect.value));
      pageTitleInput.addEventListener("input", (event) => updatePageTitle(event.target.value));
      globalSearch.addEventListener("input", renderSidebar);
      openCommandButton.addEventListener("click", openCommandPalette);

      document.addEventListener("keydown", (event) => {
        if (!slashState.open) return;
        if (event.key === "Escape") {
        if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === "k") {
          event.preventDefault();
          openCommandPalette();
        }
        if ((event.ctrlKey || event.metaKey) && event.key.toLowerCase() === "n") {
          event.preventDefault();
          closeSlashMenu();
          addPage();
        }
      });

      document.addEventListener("selectionchange", renderInlineToolbar);
      inlineToolbar.addEventListener("click", (event) => {
        const command = event.target.closest("button")?.dataset.command;
        if (!command) return;
        if (command === "highlight") {
          document.execCommand("backColor", false, "#fef9c3");
          return;
        }
        if (command === "code") {
          document.execCommand("insertHTML", false, `<code>${window.getSelection()}</code>`);
          return;
        }
        if (command === "createLink") {
          const url = prompt("Enter link URL");
          if (url) document.execCommand("createLink", false, url);
          return;
        }
        document.execCommand(command);
      });

      commandInput.addEventListener("input", renderCommandPalette);
      commandInput.addEventListener("keydown", (event) => {
        const items = Array.from(commandList.children);
        if (event.key === "ArrowDown") {
          event.preventDefault();
          slashState.selectedIndex =
            (slashState.selectedIndex + 1) % slashOptions.length;
          renderSlashMenu();
          return;
          commandIndex = Math.min(commandIndex + 1, items.length - 1);
          renderCommandPalette();
        }
        if (event.key === "ArrowUp") {
          event.preventDefault();
          slashState.selectedIndex =
            (slashState.selectedIndex - 1 + slashOptions.length) %
            slashOptions.length;
          renderSlashMenu();
          return;
          commandIndex = Math.max(commandIndex - 1, 0);
          renderCommandPalette();
        }
        if (event.key === "Enter") {
          event.preventDefault();
          const selected = slashOptions[slashState.selectedIndex];
          if (selected) {
            changeBlockType(slashState.blockId, selected.type);
          }
          closeSlashMenu();
          items[commandIndex]?.click();
        }
        if (event.key === "Escape") {
          closeCommandPalette();
        }
      });

      commandPalette.addEventListener("click", (event) => {
        if (event.target === commandPalette) closeCommandPalette();
      });

      document.querySelectorAll("[data-action]").forEach((button) => {
        button.addEventListener("click", () => {
          const action = button.dataset.action;
          if (action === "new-note") addPage({ title: "New Note" });
          if (action === "new-task") addPage({ title: "Task List" });
          if (action === "new-table") addPage({ title: "New Table" });
          if (action === "import") showToast("Import started");
        });
      });

      render();
    </script>
  </body>
</html>
=======
diff --git a/index.html b/index.html
index 4c8d0e665744fb895efff816040d6ca5a7a969a0..6e9e73ee25df2531cc0ba2ded5a23d8243d1e493 100644
--- a/index.html
+++ b/index.html
@@ -1 +1,809 @@
-<h1>Mini Notion</h1>
+<!doctype html>
+<html lang="ru">
+  <head>
+    <meta charset="UTF-8" />
+    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
+    <title>Mini Notion</title>
+    <style>
+      :root {
+        color-scheme: light;
+        font-family: "Inter", "Segoe UI", system-ui, sans-serif;
+        background: #f5f6f8;
+        color: #1f1f1f;
+      }
+
+      * {
+        box-sizing: border-box;
+      }
+
+      body {
+        margin: 0;
+        min-height: 100vh;
+        display: flex;
+      }
+
+      .app {
+        display: grid;
+        grid-template-columns: 260px 1fr;
+        width: 100%;
+        min-height: 100vh;
+      }
+
+      .sidebar {
+        background: #ffffff;
+        border-right: 1px solid #e1e4ea;
+        padding: 24px 16px;
+        display: flex;
+        flex-direction: column;
+        gap: 16px;
+      }
+
+      .sidebar h1 {
+        margin: 0;
+        font-size: 18px;
+        letter-spacing: 0.03em;
+      }
+
+      .pages {
+        display: flex;
+        flex-direction: column;
+        gap: 8px;
+        flex: 1;
+        overflow-y: auto;
+      }
+
+      .page-item {
+        border: 1px solid transparent;
+        background: #f7f7f9;
+        padding: 10px 12px;
+        border-radius: 10px;
+        display: flex;
+        align-items: center;
+        justify-content: space-between;
+        gap: 8px;
+        cursor: pointer;
+        transition: border 0.2s ease, background 0.2s ease;
+      }
+
+      .page-item.active {
+        border-color: #c7d2fe;
+        background: #eef2ff;
+      }
+
+      .page-item span {
+        font-size: 14px;
+        flex: 1;
+        white-space: nowrap;
+        overflow: hidden;
+        text-overflow: ellipsis;
+      }
+
+      .page-item button {
+        border: none;
+        background: transparent;
+        color: #9aa3b2;
+        cursor: pointer;
+        font-size: 14px;
+      }
+
+      .sidebar button,
+      .toolbar button {
+        border: none;
+        border-radius: 10px;
+        padding: 10px 12px;
+        background: #111827;
+        color: #ffffff;
+        font-size: 14px;
+        cursor: pointer;
+      }
+
+      .sidebar button.secondary {
+        background: #f3f4f6;
+        color: #111827;
+      }
+
+      .main {
+        padding: 32px 48px;
+        display: flex;
+        flex-direction: column;
+        gap: 24px;
+      }
+
+      .title-input {
+        font-size: 32px;
+        font-weight: 600;
+        border: none;
+        outline: none;
+        background: transparent;
+        width: 100%;
+      }
+
+      .toolbar {
+        display: flex;
+        align-items: center;
+        gap: 12px;
+      }
+
+      .toolbar select {
+        border-radius: 10px;
+        border: 1px solid #e1e4ea;
+        padding: 8px 10px;
+        font-size: 14px;
+        background: #ffffff;
+      }
+
+      .blocks {
+        display: flex;
+        flex-direction: column;
+        gap: 12px;
+      }
+
+      .blocks-wrapper {
+        position: relative;
+      }
+
+      .block {
+        display: flex;
+        align-items: flex-start;
+        gap: 12px;
+        padding: 12px 14px;
+        border-radius: 12px;
+        background: #ffffff;
+        border: 1px solid #edf0f5;
+      }
+
+      .block textarea,
+      .block [contenteditable="true"] {
+        border: none;
+        outline: none;
+        width: 100%;
+        font-size: 16px;
+        font-family: inherit;
+        resize: none;
+      }
+
+      .block .heading {
+        font-size: 20px;
+        font-weight: 600;
+      }
+
+      .block .checkbox-text {
+        flex: 1;
+        font-size: 16px;
+      }
+
+      .checkbox-items {
+        display: flex;
+        flex-direction: column;
+        gap: 8px;
+        flex: 1;
+      }
+
+      .checkbox-item {
+        display: flex;
+        align-items: center;
+        gap: 10px;
+      }
+
+      .checkbox-item input[type="checkbox"] {
+        margin: 0;
+      }
+
+      .checkbox-item .item-text {
+        flex: 1;
+        outline: none;
+      }
+
+      .checkbox-actions {
+        display: flex;
+        justify-content: flex-start;
+      }
+
+      .checkbox-actions button {
+        border: 1px dashed #cbd5e1;
+        background: transparent;
+        color: #475569;
+        border-radius: 10px;
+        padding: 6px 12px;
+        cursor: pointer;
+        font-size: 13px;
+      }
+
+      .checkbox-actions button:disabled {
+        opacity: 0.5;
+        cursor: not-allowed;
+      }
+
+      .block .delete {
+        border: none;
+        background: transparent;
+        color: #9aa3b2;
+        cursor: pointer;
+        font-size: 16px;
+      }
+
+      .empty {
+        color: #9aa3b2;
+        font-size: 14px;
+      }
+
+      .slash-menu {
+        position: absolute;
+        min-width: 180px;
+        background: #ffffff;
+        border: 1px solid #e2e8f0;
+        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
+        border-radius: 12px;
+        padding: 6px;
+        z-index: 10;
+      }
+
+      .slash-menu[hidden] {
+        display: none;
+      }
+
+      .slash-menu-item {
+        display: flex;
+        align-items: center;
+        gap: 10px;
+        padding: 8px 10px;
+        border-radius: 10px;
+        cursor: pointer;
+        font-size: 14px;
+      }
+
+      .slash-menu-item.active {
+        background: #eef2ff;
+        color: #1d4ed8;
+      }
+
+      @media (max-width: 900px) {
+        .app {
+          grid-template-columns: 1fr;
+        }
+
+        .sidebar {
+          border-right: none;
+          border-bottom: 1px solid #e1e4ea;
+        }
+      }
+    </style>
+  </head>
+  <body>
+    <div class="app">
+      <aside class="sidebar">
+        <h1>Mini Notion</h1>
+        <div class="pages" id="pages"></div>
+        <button id="add-page">–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</button>
+      </aside>
+      <main class="main">
+        <input
+          id="page-title"
+          class="title-input"
+          type="text"
+          placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"
+        />
+        <div class="toolbar">
+          <select id="block-type">
+            <option value="text">–¢–µ–∫—Å—Ç</option>
+            <option value="heading">–ó–∞–≥–æ–ª–æ–≤–æ–∫</option>
+            <option value="checkbox">–ß–µ–∫–±–æ–∫—Å</option>
+          </select>
+          <button id="add-block">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
+        </div>
+        <div class="blocks-wrapper">
+          <div class="blocks" id="blocks"></div>
+          <div class="empty" id="empty-state" hidden>
+            –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –±–ª–æ–∫, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–∏—Å–∞—Ç—å.
+          </div>
+          <div class="slash-menu" id="slash-menu" hidden></div>
+        </div>
+      </main>
+    </div>
+
+    <script>
+      const STORAGE_KEY = "mini-notion-data";
+      const pagesContainer = document.getElementById("pages");
+      const addPageButton = document.getElementById("add-page");
+      const pageTitleInput = document.getElementById("page-title");
+      const blockTypeSelect = document.getElementById("block-type");
+      const addBlockButton = document.getElementById("add-block");
+      const blocksContainer = document.getElementById("blocks");
+      const emptyState = document.getElementById("empty-state");
+      const slashMenu = document.getElementById("slash-menu");
+      const blocksWrapper = document.querySelector(".blocks-wrapper");
+
+      const defaultState = () => ({
+        activePageId: "page-1",
+        pages: [
+          {
+            id: "page-1",
+            title: "–ú–æ—è –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",
+            blocks: [
+              { id: "block-1", type: "heading", content: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å" },
+              {
+                id: "block-2",
+                type: "text",
+                content: "–≠—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–º–µ—Ç–æ–∫ –≤ —Å—Ç–∏–ª–µ Notion.",
+              },
+              {
+                id: "block-3",
+                type: "checkbox",
+                content: "–°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —Å–ø–∏—Å–æ–∫",
+                checked: false,
+              },
+            ],
+          },
+        ],
+      });
+
+      const loadState = () => {
+        const saved = localStorage.getItem(STORAGE_KEY);
+        if (!saved) {
+          return defaultState();
+        }
+        try {
+          return JSON.parse(saved);
+        } catch (error) {
+          console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage", error);
+          return defaultState();
+        }
+      };
+
+      let state = loadState();
+      const slashOptions = [
+        { type: "text", label: "–¢–µ–∫—Å—Ç" },
+        { type: "heading", label: "–ó–∞–≥–æ–ª–æ–≤–æ–∫" },
+        { type: "checkbox", label: "–ß–µ–∫–±–æ–∫—Å" },
+      ];
+      const slashState = {
+        open: false,
+        blockId: null,
+        selectedIndex: 0,
+        position: { x: 0, y: 0 },
+      };
+
+      const saveState = () => {
+        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
+      };
+
+      const generateId = (prefix) =>
+        `${prefix}-${Math.random().toString(36).slice(2, 9)}`;
+
+      const getActivePage = () =>
+        state.pages.find((page) => page.id === state.activePageId);
+
+      const setActivePage = (pageId) => {
+        state.activePageId = pageId;
+        saveState();
+        render();
+      };
+
+      const addPage = () => {
+        const newPage = {
+          id: generateId("page"),
+          title: "–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",
+          blocks: [],
+        };
+        state.pages.unshift(newPage);
+        state.activePageId = newPage.id;
+        saveState();
+        render();
+      };
+
+      const deletePage = (pageId) => {
+        if (state.pages.length === 1) {
+          return;
+        }
+        state.pages = state.pages.filter((page) => page.id !== pageId);
+        if (state.activePageId === pageId) {
+          state.activePageId = state.pages[0].id;
+        }
+        saveState();
+        render();
+      };
+
+      const addBlock = (type) => {
+        const page = getActivePage();
+        if (!page) return;
+        const newBlock = {
+          id: generateId("block"),
+          type,
+          content:
+            type === "heading"
+              ? "–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫"
+              : type === "checkbox"
+                ? undefined
+                : "–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç",
+          checked: type === "checkbox" ? false : undefined,
+          items:
+            type === "checkbox"
+              ? [
+                  {
+                    id: generateId("item"),
+                    text: "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç",
+                    checked: false,
+                  },
+                ]
+              : undefined,
+        };
+        page.blocks.push(newBlock);
+        saveState();
+        render();
+      };
+
+      const deleteBlock = (blockId) => {
+        const page = getActivePage();
+        if (!page) return;
+        page.blocks = page.blocks.filter((block) => block.id !== blockId);
+        saveState();
+        render();
+      };
+
+      const updateBlockContent = (blockId, content) => {
+        const page = getActivePage();
+        if (!page) return;
+        const block = page.blocks.find((item) => item.id === blockId);
+        if (!block) return;
+        if (block.type === "checkbox") return;
+        block.content = content;
+        saveState();
+      };
+
+      const updateBlockChecked = (blockId, checked) => {
+        const page = getActivePage();
+        if (!page) return;
+        const block = page.blocks.find((item) => item.id === blockId);
+        if (!block) return;
+        block.checked = checked;
+        saveState();
+      };
+
+      const updateCheckboxItemContent = (blockId, itemId, text) => {
+        const page = getActivePage();
+        if (!page) return;
+        const block = page.blocks.find((item) => item.id === blockId);
+        if (!block || block.type !== "checkbox") return;
+        const item = block.items?.find((entry) => entry.id === itemId);
+        if (!item) return;
+        item.text = text;
+        saveState();
+      };
+
+      const updateCheckboxItemChecked = (blockId, itemId, checked) => {
+        const page = getActivePage();
+        if (!page) return;
+        const block = page.blocks.find((item) => item.id === blockId);
+        if (!block || block.type !== "checkbox") return;
+        const item = block.items?.find((entry) => entry.id === itemId);
+        if (!item) return;
+        item.checked = checked;
+        saveState();
+      };
+
+      const addCheckboxItem = (blockId) => {
+        const page = getActivePage();
+        if (!page) return;
+        const block = page.blocks.find((item) => item.id === blockId);
+        if (!block || block.type !== "checkbox") return;
+        if (!block.items) block.items = [];
+        if (block.items.length >= 10) return;
+        block.items.push({
+          id: generateId("item"),
+          text: "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç",
+          checked: false,
+        });
+        saveState();
+        render();
+        focusBlock(blockId, block.items.length - 1);
+      };
+
+      const changeBlockType = (blockId, type) => {
+        const page = getActivePage();
+        if (!page) return;
+        const block = page.blocks.find((item) => item.id === blockId);
+        if (!block || block.type === type) return;
+        if (type === "checkbox") {
+          const existingText =
+            block.content ||
+            (block.items && block.items[0] ? block.items[0].text : "") ||
+            "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç";
+          block.type = "checkbox";
+          block.items = [
+            { id: generateId("item"), text: existingText, checked: false },
+          ];
+          delete block.content;
+          delete block.checked;
+        } else {
+          const existingText =
+            block.content ||
+            (block.items && block.items[0] ? block.items[0].text : "");
+          block.type = type;
+          block.content =
+            existingText || (type === "heading" ? "–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫" : "–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç");
+          delete block.items;
+          delete block.checked;
+        }
+        saveState();
+        render();
+        focusBlock(blockId);
+      };
+
+      const normalizeCheckboxBlock = (block) => {
+        if (block.type !== "checkbox") return false;
+        if (!Array.isArray(block.items)) {
+          block.items = [
+            {
+              id: generateId("item"),
+              text: block.content || "–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç",
+              checked: Boolean(block.checked),
+            },
+          ];
+          delete block.content;
+          delete block.checked;
+          return true;
+        }
+        let updated = false;
+        block.items = block.items.map((item) => {
+          if (!item.id) {
+            updated = true;
+            return { ...item, id: generateId("item") };
+          }
+          return item;
+        });
+        return updated;
+      };
+
+      const getCaretRect = (fallbackElement) => {
+        const selection = window.getSelection();
+        if (selection && selection.rangeCount > 0) {
+          const range = selection.getRangeAt(0);
+          const rect = range.getBoundingClientRect();
+          if (rect && (rect.top || rect.left || rect.width || rect.height)) {
+            return rect;
+          }
+        }
+        return fallbackElement.getBoundingClientRect();
+      };
+
+      const positionSlashMenu = () => {
+        const wrapperRect = blocksWrapper.getBoundingClientRect();
+        slashMenu.style.left = `${slashState.position.x - wrapperRect.left}px`;
+        slashMenu.style.top = `${slashState.position.y - wrapperRect.top}px`;
+      };
+
+      const openSlashMenu = (blockId, rect) => {
+        slashState.open = true;
+        slashState.blockId = blockId;
+        slashState.selectedIndex = 0;
+        slashState.position = {
+          x: rect.left,
+          y: rect.bottom + 8,
+        };
+        renderSlashMenu();
+        slashMenu.hidden = false;
+        positionSlashMenu();
+      };
+
+      const closeSlashMenu = () => {
+        slashState.open = false;
+        slashState.blockId = null;
+        slashMenu.hidden = true;
+      };
+
+      const renderSlashMenu = () => {
+        slashMenu.innerHTML = "";
+        slashOptions.forEach((option, index) => {
+          const item = document.createElement("div");
+          item.className = `slash-menu-item${
+            slashState.selectedIndex === index ? " active" : ""
+          }`;
+          item.textContent = option.label;
+          item.addEventListener("click", () => {
+            changeBlockType(slashState.blockId, option.type);
+            closeSlashMenu();
+          });
+          slashMenu.appendChild(item);
+        });
+      };
+
+      const focusBlock = (blockId, itemIndex = 0) => {
+        const selector = `[data-block-id=\"${blockId}\"]`;
+        const blockElement = document.querySelector(selector);
+        if (!blockElement) return;
+        const checkboxItems = blockElement.querySelectorAll(
+          ".checkbox-item .item-text"
+        );
+        if (checkboxItems.length > 0) {
+          const target = checkboxItems[itemIndex] || checkboxItems[0];
+          target.focus();
+          return;
+        }
+        const editable = blockElement.querySelector("[contenteditable=\"true\"]");
+        if (editable) {
+          editable.focus();
+        }
+      };
+
+      const updatePageTitle = (title) => {
+        const page = getActivePage();
+        if (!page) return;
+        page.title = title;
+        saveState();
+        renderPages();
+      };
+
+      const renderPages = () => {
+        pagesContainer.innerHTML = "";
+        state.pages.forEach((page) => {
+          const item = document.createElement("div");
+          item.className = `page-item${
+            page.id === state.activePageId ? " active" : ""
+          }`;
+
+          const title = document.createElement("span");
+          title.textContent = page.title || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
+          item.appendChild(title);
+
+          const removeButton = document.createElement("button");
+          removeButton.textContent = "√ó";
+          removeButton.title = "–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É";
+          removeButton.addEventListener("click", (event) => {
+            event.stopPropagation();
+            deletePage(page.id);
+          });
+          item.appendChild(removeButton);
+
+          item.addEventListener("click", () => setActivePage(page.id));
+          pagesContainer.appendChild(item);
+        });
+      };
+
+      const renderBlocks = () => {
+        const page = getActivePage();
+        blocksContainer.innerHTML = "";
+        if (!page || page.blocks.length === 0) {
+          emptyState.hidden = false;
+          return;
+        }
+        emptyState.hidden = true;
+        page.blocks.forEach((block) => {
+          const row = document.createElement("div");
+          row.className = "block";
+          row.dataset.blockId = block.id;
+
+          if (block.type === "checkbox") {
+            const updated = normalizeCheckboxBlock(block);
+            if (updated) {
+              saveState();
+            }
+            const items = document.createElement("div");
+            items.className = "checkbox-items";
+
+            block.items.forEach((item) => {
+              const itemRow = document.createElement("div");
+              itemRow.className = "checkbox-item";
+
+              const checkbox = document.createElement("input");
+              checkbox.type = "checkbox";
+              checkbox.checked = Boolean(item.checked);
+              checkbox.addEventListener("change", (event) => {
+                updateCheckboxItemChecked(block.id, item.id, event.target.checked);
+              });
+              itemRow.appendChild(checkbox);
+
+              const text = document.createElement("div");
+              text.className = "item-text";
+              text.contentEditable = "true";
+              text.textContent = item.text;
+              text.addEventListener("input", (event) => {
+                updateCheckboxItemContent(
+                  block.id,
+                  item.id,
+                  event.target.textContent.trim()
+                );
+              });
+              itemRow.appendChild(text);
+              items.appendChild(itemRow);
+            });
+
+            const actions = document.createElement("div");
+            actions.className = "checkbox-actions";
+            const addItemButton = document.createElement("button");
+            addItemButton.type = "button";
+            addItemButton.textContent = "–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç";
+            addItemButton.disabled = block.items.length >= 10;
+            addItemButton.addEventListener("click", () => addCheckboxItem(block.id));
+            actions.appendChild(addItemButton);
+            items.appendChild(actions);
+
+            row.appendChild(items);
+          } else {
+            const text = document.createElement("div");
+            text.contentEditable = "true";
+            text.textContent = block.content;
+            if (block.type === "heading") {
+              text.classList.add("heading");
+            }
+            text.addEventListener("keydown", (event) => {
+              if (
+                event.key === "/" &&
+                text.textContent.trim() === "" &&
+                !event.shiftKey
+              ) {
+                event.preventDefault();
+                openSlashMenu(block.id, getCaretRect(text));
+              }
+            });
+            text.addEventListener("input", (event) => {
+              updateBlockContent(block.id, event.target.textContent.trim());
+            });
+            row.appendChild(text);
+          }
+
+          const deleteButton = document.createElement("button");
+          deleteButton.className = "delete";
+          deleteButton.textContent = "–£–¥–∞–ª–∏—Ç—å";
+          deleteButton.addEventListener("click", () => deleteBlock(block.id));
+          row.appendChild(deleteButton);
+
+          blocksContainer.appendChild(row);
+        });
+      };
+
+      const render = () => {
+        closeSlashMenu();
+        renderPages();
+        const page = getActivePage();
+        pageTitleInput.value = page ? page.title : "";
+        renderBlocks();
+      };
+
+      addPageButton.addEventListener("click", addPage);
+      addBlockButton.addEventListener("click", () =>
+        addBlock(blockTypeSelect.value)
+      );
+      pageTitleInput.addEventListener("input", (event) =>
+        updatePageTitle(event.target.value)
+      );
+      document.addEventListener("click", (event) => {
+        if (!slashState.open) return;
+        if (slashMenu.contains(event.target)) return;
+        closeSlashMenu();
+      });
+      document.addEventListener("keydown", (event) => {
+        if (!slashState.open) return;
+        if (event.key === "Escape") {
+          event.preventDefault();
+          closeSlashMenu();
+          return;
+        }
+        if (event.key === "ArrowDown") {
+          event.preventDefault();
+          slashState.selectedIndex =
+            (slashState.selectedIndex + 1) % slashOptions.length;
+          renderSlashMenu();
+          return;
+        }
+        if (event.key === "ArrowUp") {
+          event.preventDefault();
+          slashState.selectedIndex =
+            (slashState.selectedIndex - 1 + slashOptions.length) %
+            slashOptions.length;
+          renderSlashMenu();
+          return;
+        }
+        if (event.key === "Enter") {
+          event.preventDefault();
+          const selected = slashOptions[slashState.selectedIndex];
+          if (selected) {
+            changeBlockType(slashState.blockId, selected.type);
+          }
+          closeSlashMenu();
+        }
+      });
+
+      render();
+    </script>
+  </body>
+</html>
